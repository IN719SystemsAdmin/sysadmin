const int sensorPin = 0;
const int ledPin = 9;

//global variables for the light level:
int lightLevel, high = 0, low = 1023;
  
void setup()
{
  //LED pin is set to be an output.
  pinMode(ledPin, OUTPUT);
}


void loop()
{
  lightLevel = analogRead(sensorPin);
  lightLevel = map(lightLevel, 1023, 0, 0, 255);
  autoTune(); 
  analogWrite(ledPin, lightLevel);
}

void autoTune()
{
  if (lightLevel < low)
  {
    low = lightLevel;
  }
  
  if (lightLevel > high)
  {
    high = lightLevel;
  }
  
  lightLevel = map(lightLevel, low+30, high-30, 0, 255);
  lightLevel = constrain(lightLevel, 0, 255);
  
}

